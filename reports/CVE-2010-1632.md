## CVE-2010-1632

https://github.com/advisories/GHSA-23vv-v25h-qwqw

Уязвимость связана с неправильной валидацией входных данных. До версии 1.5.2 сервер не отклоняет DTD в SOAP-сообщениях.
Это позволяет злоумышленникам использовать специально сформированные DTD для выполнения атак. Например, чтение
произвольных файлов или отправка HTTP-запросов на внутренние серверы

## POC

[ApacheAxisAttack.java](../src/main/java/org/example/ApacheAxisAttack.java)

## Sink

java.io.InputStreamReader.read

Цепочка от публичного метода примерно такая:

- org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.<init>
- org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.getSOAPEnvelope
- org.apache.axiom.om.impl.builder.StAXOMBuilder.next
- org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.createDTD
- java.io.InputStreamReader.read

## Fix

Исправление в
репозитории: https://svn.apache.org/repos/asf/axis/axis2/java/core/security/secfix-cve-2010-1632/src/main/java/org/apache/axis2/builder/SecureApplicationXMLBuilder.java
Объяснение: https://svn.apache.org/repos/asf/axis/axis2/java/core/security/CVE-2010-1632.pdf

Другими словами сделали так:

```
inputFactory = XMLInputFactory.newInstance();
inputFactory.setProperty(XMLInputFactory.SUPPORT_DTD, Boolean.FALSE); 
inputFactory.setProperty(XMLInputFactory.IS_REPLACING_ENTITY_REFERENCES, Boolean.FALSE);
inputFactory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);
```

То есть настроили XML-парсер так, чтобы он не поддерживал внешние сущности => уязвимости, связанные с DTD, в частности
XXE, стали невозможны. XML-парсер просто не будет их обрабатывать, а значит не будут выполняться сетевые запросы и
прочие подобные вещи

На более поздней версии библиотеки получаем ошибку, что демонстрирует пофикшенную уязвимость:

```
Exception in thread "main" org.apache.axiom.om.OMException: SOAP message MUST NOT contain a Document Type Declaration(DTD)
	at org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.createDTD(StAXSOAPModelBuilder.java:423)
	at org.apache.axiom.om.impl.builder.StAXOMBuilder.next(StAXOMBuilder.java:244)
	at org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.getSOAPEnvelope(StAXSOAPModelBuilder.java:161)
	at org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder.<init>(StAXSOAPModelBuilder.java:110)
	at org.example.Main.main(Main.java:32)
```
