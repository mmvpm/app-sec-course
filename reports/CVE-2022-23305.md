## CVE-2022-23305

https://github.com/advisories/GHSA-65fg-84f6-3jq3

Уязвимость связана с тем, что компонент JDBCAppender принимает SQL-запрос как параметр конфигурации. 
Таким образом, можно производить SQL-инъекции, вводя в систему данные, которые потом логируются.

## POC

Сначала нужно подготовить MySQL

```bash
docker run --name cve-mysql -e MYSQL_ROOT_PASSWORD=secret -e MYSQL_DATABASE=cve -e MYSQL_USER=me -e MYSQL_PASSWORD=secret -p 3306:3306 -d mysql:8.0
docker exec -it cve-mysql mysql -u me -p
use cve;
CREATE TABLE logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    message VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

Далее запустить код:

[Log4jAttack.java](../src/main/java/org/example/Log4jAttack.java)

Результат (заменили все логи на слово "hacked"):

```
mysql> select * from logs;
+----+---------+---------------------+
| id | message | created_at          |
+----+---------+---------------------+
|  1 | hacked  | 2025-03-02 12:54:20 |
|  2 | hacked  | 2025-03-02 12:54:22 |
|  3 | hacked  | 2025-03-02 12:54:25 |
|  4 | hacked  | 2025-03-02 12:57:15 |
|  5 | hacked  | 2025-03-02 12:58:57 |
+----+---------+---------------------+
14 rows in set (0.01 sec)
```

## Sink

java.sql.Statement.executeUpdate (вызывается из org.apache.log4j.jdbc.JDBCAppender.execute)

Публичный метод логирования: org.apache.log4j.Category.info

## Fix

Исправления в репозитории нет, есть максимум
такое: https://github.com/apache/logging-log4j1/commit/e6369fbcf94ac28d233855da0466f4628f247382

Возможное исправление от меня:
Добавить обработку пользовательского ввода с использованием PreparedStatement вместо обычного SQL-запроса, где он
напрямую включался в строку запроса.
Таким образом, входные данные будут правильно экранироваться, и SQL-инъекция станет невозможна.
