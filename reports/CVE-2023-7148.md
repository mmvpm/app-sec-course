## CVE-2023-7148

https://github.com/advisories/GHSA-5fpq-3c9p-3r3w

Уязвимость позволяет злоумышленникам внедрять и выполнять произвольный код

## POC

У меня не получилось затащить библиотеку, как зависимость, к себе в проект (что-то не смогло скачать с мавена, и я не
придумал, как это фиксить). Но POC будет примерно такой:

```java
ModelConfig modelConfig = new ModelConfig();
String expression = "Runtime.getRuntime().exec('cat /etc/hosts')";
DataPurifier purifier = new DataPurifier(modelConfig, expression, true);
```

То есть просто передали во второй конструктор произвольный скрипт

## Sink

org.apache.commons.jexl2.JexlEngine#createExpression

## CodeQL

Публичные методы, куда можно подсунуть произвольное выражение — 3 конструктора DataPurifier:

- public DataPurifier(ModelConfig modelConfig, boolean isForValidationDataSet)
- public DataPurifier(ModelConfig modelConfig, String filterExpressions, boolean strict)
- public DataPurifier(EvalConfig evalConfig) throws IOException

Также есть protected методы:

- NormalizeUDF#createExpressionMap(List<WeightAmplifier> weightExprList)
- DataNormalizeWorker#createExpressionMap(List<WeightAmplifier> weightExprList)
- NormalizeParquetUDF#createExpressionMap(List<WeightAmplifier> weightExprList)

Их тоже можно считать уязвимыми, так как классы не финальные. То есть можно отнаследоваться и передать нужный
`WeightAmplifier`, который легко создается с нужными аргументами:

```java
public WeightAmplifier(Double targetWeight, String targetExpression) {
    super();
    this.targetWeight = targetWeight;
    this.targetExpression = targetExpression;
}
```

## Fix

В репозитории фикса нет, то есть проблема до сих пор не исправлена в последней версии

Могу предложить свой фикс: в 6 местах выше добавить сразу после `jexl = new JexlEngine();` строчку, которая запретит
любые функции, в том числе и внутренние:

```java
jexl.setFunctions(Collections.EMPTY_MAP);
```
